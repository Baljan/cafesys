{% extends "site_base.html" %}
{% load i18n %}
{% load humanize %}

{% block extra_head %}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/calendar.css" />
{% endblock %}

{% block subnav %}
<ul>
    <li><a href="{% url cal.views.worker_calendar %}">{% trans "Calendar" %}</a></li>
    {% if is_worker %}
    <li><a href="{% url cal.views.swappable %}">{% trans "Shift Swaps" %}</a></li>
    {% endif %}
</ul>
{% endblock %}

{% block body_class %}calendar{% endblock %}

{% block extra_body %}
    <script type="text/javascript">
        {% if is_regular %}
            IS_REGULAR=true;
        {% else %}
            IS_REGULAR=false;
        {% endif %}
        {% if is_worker %}
            IS_WORKER=true;
        {% else %}
            IS_WORKER=false;
        {% endif %}
        {% if is_board_member %}
            IS_BOARD_MEMBER=true;
        {% else %}
            IS_BOARD_MEMBER=false;
        {% endif %}
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/calendar.js"></script> 
{% endblock %}

{% load ifsetting_tag %}

{% block head_title %}{% trans "Calendar" %}{% endblock %}

{% block body %}
    <h1>{% trans "Calendar" %}</h1>
    {% if is_board_member %}
        <div id="calendar-modes">
            <ul>
                <li class="manage-shifts-mode">{% trans "add or remove shifts" %}</li>
                <li class="worker-mode">{% trans "worker mode" %}</li>
            </ul>
        </div>
        <div id="calendar-tasks">
            <strong>{% trans "With selection" %}&hellip;</strong>
            <ul>
                <li id="add-shifts">{% trans "add shifts" %}</li>
                <li id="remove-shifts">{% trans "remove shifts" %}</li>
            </ul>
            <p class="help">
                <strong>{% trans "Hint" %}:</strong>
                {% trans "Hold the <code>Ctrl</code> key for multi-select mode." %}
            </p>
            <p class="help">
                <strong>{% trans "Note" %}:</strong>
                {% trans "Shifts will be removed even if workers have signed up for them." %}
            </p>
            <p class="confirmation">
                <span class="confirm">&#x2611; {% trans "confirm" %}</span>
            </p>
        </div>
    {% endif %}
    {% if is_regular %}
    <div class="become-worker-request">
        <ul>
            <li><a href="{% url liu.views.request_become_worker %}">{% trans "Request to become a worker" %}</a></li>
        </ul>
    </div>
    {% endif %}
    {% if student_shifts %}
        <div>
            <h3>{% trans "My Shifts" %}</h3>
            <table class="student-shifts">
                <thead>
                    <tr>
                        <th class="date">{% trans "date" %}</th>
                        <th class="when">{% trans "when" %}</th>
                        <th class="swappable">{% trans "swappable" %}</th>
                        <th class="tasks">{% trans "tasks" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for shift in student_shifts %}
                    <tr>
                        <td class="date">
                            <a title="{% trans "go to this month" %}" href="{% url cal.views.worker_calendar shift.shift.day.year shift.shift.day.month %}">{{ shift.shift.day|naturalday:"Y-m-d" }}</a>
                        </td>
                        <td class="when">{% trans shift.shift.name %}</td>
                        <td class="swappable">
                            {# The schedule id must be the last class. #}
                            <span title="{% trans "toggle swappability" %}" class="toggle-swappable scheduled-{{shift.shift.name}}-{{shift.pk}}">
                                {% if shift.swappable %}
                                    &#x2611;
                                {% else %}
                                    &#x2610;
                                {% endif %}
                            </span>
                        </td>
                        <td class="tasks">
                            {# The schedule id must be the last class. #}
                            <span class="link remove-scheduled scheduled-{{shift.shift.name}}-{{shift.pk}}">
                                {% trans "remove" %}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
    {% if year_view %}
        <p class="cal-views"> 
            <a href="{% url cal.views.worker_calendar %}">{% trans "month view" %}</a>
        </p>
    {% else %}
        {% spaceless %}
        {% if is_board_member or is_worker %}
            <p class="cal-views"> 
                <a href="{% url cal.views.worker_calendar year None %}">{% trans "year view" %}</a>
            </p>
        {% endif %}
        <p class="calendar-nav">
            <a class="prev" href="{% url cal.views.worker_calendar prev_month.year prev_month.month %}">
                &larr; {{ prev_month|date:"F Y" }}
            </a>
            <a class="next" href="{% url cal.views.worker_calendar next_month.year next_month.month %}">
                {{ next_month|date:"F Y" }} &rarr;
            </a>
        </p>
        {% endspaceless %}
    {% endif %}
    <div class="calendars {% if year_view %}year{% endif %}">
        {% for first_day, week_data in calendar %}
            <h2>{{ first_day|date:"F Y" }}</h2>
            {% spaceless %}
                <table class="cal-month">
                    <thead>
                        <tr>
                            <th class="week">{% trans "week" %}</th>
                            <th>{% trans "Mon" %}</th>
                            <th>{% trans "Tue" %}</th>
                            <th>{% trans "Wed" %}</th>
                            <th>{% trans "Thu" %}</th>
                            <th>{% trans "Fri" %}</th>
                            <th class="weekend">{% trans "Sat" %}</th>
                            <th class="weekend">{% trans "Sun" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for week in week_data %}
                        <tr>
                            <td class="week">{% if week.number != 0 %}{{week.number}}{% endif%}</td>
                            {% for day in week.days %}
                                <td {% if day.id %}id="{{day.id}}"{% endif %} class="day {{day.classes}}">
                                    <div class="morning-box"></div>
                                    <div class="afternoon-box"></div>
                                    <div class="day-of-month">{% if day.same_month %}{{day.day}}{% endif %}</div>
                                    {% if day.workers|length != 0 %}
                                        <div class="tooltip">
                                            <p>
                                                {% if day.morning|length != 0 %}
                                                    <strong>{% trans "Morning workers" %}:</strong><br/>
                                                    {{day.morning|join:", "}}
                                                {% endif %}
                                            </p>
                                            <p>
                                                {% if day.afternoon|length != 0 %}
                                                    <strong>{% trans "Afternoon workers" %}:</strong><br/>
                                                    {{day.afternoon|join:", "}}
                                                {% endif %}
                                            </p>
                                        </div>
                                    {% endif %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endspaceless %}
        {% endfor %}
    </div>
{% endblock %}
